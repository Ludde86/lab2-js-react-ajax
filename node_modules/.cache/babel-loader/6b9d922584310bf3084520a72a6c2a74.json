{"ast":null,"code":"import _objectWithoutProperties from \"C:\\\\Users\\\\Ludde\\\\Desktop\\\\lab2-js-react-ajax\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectWithoutProperties\";\nimport _objectSpread from \"C:\\\\Users\\\\Ludde\\\\Desktop\\\\lab2-js-react-ajax\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"C:\\\\Users\\\\Ludde\\\\Desktop\\\\lab2-js-react-ajax\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\Ludde\\\\Desktop\\\\lab2-js-react-ajax\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport { getQueryString } from \"./helpers\";\nexport var url = \"https://www.forverkliga.se/JavaScript/api/crud.php\";\n\nvar requestApiKey =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee() {\n    var cachedKey, apiKey;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            cachedKey = localStorage.getItem(\"apiKey\");\n\n            if (!cachedKey) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", cachedKey);\n\n          case 5:\n            _context.prev = 5;\n            _context.next = 8;\n            return fetch(\"\".concat(url, \"?requestKey\")).then(function (response) {\n              return response.json();\n            }).then(function (result) {\n              return result.key;\n            });\n\n          case 8:\n            apiKey = _context.sent;\n            localStorage.setItem(\"apiKey\", apiKey);\n            return _context.abrupt(\"return\", apiKey);\n\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](5);\n            return _context.abrupt(\"return\", _context.t0);\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[5, 13]]);\n  }));\n\n  return function requestApiKey() {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar sendRequest =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(params) {\n    var limit,\n        key,\n        qs,\n        _ref3,\n        status,\n        message,\n        response,\n        _args2 = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            limit = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : 10;\n            _context2.next = 3;\n            return requestApiKey();\n\n          case 3:\n            key = _context2.sent;\n            qs = getQueryString(_objectSpread({}, params, {\n              key: key\n            }));\n            _context2.next = 7;\n            return fetch(\"\".concat(url, \"?\").concat(qs)).then(function (response) {\n              return response.json();\n            });\n\n          case 7:\n            _ref3 = _context2.sent;\n            status = _ref3.status;\n            message = _ref3.message;\n            response = _objectWithoutProperties(_ref3, [\"status\", \"message\"]);\n\n            if (!(status === \"success\")) {\n              _context2.next = 15;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", _objectSpread({}, response, {\n              status: status\n            }));\n\n          case 15:\n            if (!(limit > 0 && status === \"error\")) {\n              _context2.next = 20;\n              break;\n            }\n\n            console.log({\n              limit: limit,\n              message: message\n            });\n            return _context2.abrupt(\"return\", sendRequest(params, limit - 1));\n\n          case 20:\n            return _context2.abrupt(\"return\", {\n              status: status,\n              message: message\n            });\n\n          case 21:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function sendRequest(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport var fetchBooks =\n/*#__PURE__*/\nfunction () {\n  var _ref4 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3() {\n    var params;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            params = {\n              op: \"select\"\n            };\n            _context3.next = 3;\n            return sendRequest(params);\n\n          case 3:\n            return _context3.abrupt(\"return\", _context3.sent);\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function fetchBooks() {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var addBook =\n/*#__PURE__*/\nfunction () {\n  var _ref5 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee4(title, author) {\n    var limit,\n        params,\n        _args4 = arguments;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            limit = _args4.length > 2 && _args4[2] !== undefined ? _args4[2] : 10;\n            params = {\n              op: \"insert\",\n              title: title,\n              author: author\n            };\n            console.log(\"Book added: \" + title);\n            _context4.next = 5;\n            return sendRequest(params);\n\n          case 5:\n            return _context4.abrupt(\"return\", _context4.sent);\n\n          case 6:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function addBook(_x2, _x3) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nexport var removeBook =\n/*#__PURE__*/\nfunction () {\n  var _ref6 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee5(id) {\n    var params;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            params = {\n              id: id,\n              op: \"delete\"\n            };\n            _context5.next = 3;\n            return sendRequest(params);\n\n          case 3:\n            return _context5.abrupt(\"return\", _context5.sent);\n\n          case 4:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n\n  return function removeBook(_x4) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nexport var updateBook =\n/*#__PURE__*/\nfunction () {\n  var _ref7 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee6(id, title, author) {\n    var params;\n    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            params = {\n              id: id,\n              title: title,\n              author: author,\n              op: \"update\"\n            };\n            _context6.next = 3;\n            return sendRequest(params);\n\n          case 3:\n            return _context6.abrupt(\"return\", _context6.sent);\n\n          case 4:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n\n  return function updateBook(_x5, _x6, _x7) {\n    return _ref7.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["C:\\Users\\Ludde\\Desktop\\lab2-js-react-ajax\\src\\utils\\api.js"],"names":["getQueryString","url","requestApiKey","cachedKey","localStorage","getItem","fetch","then","response","json","result","key","apiKey","setItem","sendRequest","params","limit","qs","status","message","console","log","fetchBooks","op","addBook","title","author","removeBook","id","updateBook"],"mappings":"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","sourcesContent":["import { getQueryString } from \"./helpers\";\r\n\r\nexport const url = \"https://www.forverkliga.se/JavaScript/api/crud.php\";\r\n\r\nconst requestApiKey = async () => {\r\n  const cachedKey = localStorage.getItem(\"apiKey\");\r\n\r\n  if (cachedKey) {\r\n    return cachedKey;\r\n  } else {\r\n    try {\r\n      const apiKey = await fetch(`${url}?requestKey`)\r\n        .then(response => response.json())\r\n        .then(result => result.key);\r\n\r\n      localStorage.setItem(\"apiKey\", apiKey);\r\n      return apiKey;\r\n    } catch (err) {\r\n      return err;\r\n    }\r\n  }\r\n};\r\n\r\nconst sendRequest = async (params, limit = 10) => {\r\n  const key = await requestApiKey();\r\n  const qs = getQueryString({\r\n    ...params,\r\n    key\r\n  });\r\n\r\n  const { status, message, ...response } = await fetch(`${url}?${qs}`).then(\r\n    response => response.json()\r\n  );\r\n\r\n  if (status === \"success\") {\r\n    return { ...response, status };\r\n  } else if (limit > 0 && status === \"error\") {\r\n    console.log({ limit, message });\r\n    return sendRequest(params, limit - 1);\r\n  } else {\r\n    return { status, message };\r\n  }\r\n};\r\n\r\nexport const fetchBooks = async () => {\r\n  const params = {\r\n    op: \"select\"\r\n  };\r\n\r\n  return await sendRequest(params);\r\n};\r\n\r\nexport const addBook = async (title, author, limit = 10) => {\r\n  const params = {\r\n    op: \"insert\",\r\n    title,\r\n    author\r\n  };\r\n  console.log(\"Book added: \" + title);\r\n  return await sendRequest(params);\r\n};\r\n\r\nexport const removeBook = async id => {\r\n  const params = {\r\n    id,\r\n    op: \"delete\"\r\n  };\r\n\r\n  return await sendRequest(params);\r\n};\r\n\r\nexport const updateBook = async (id, title, author) => {\r\n  const params = {\r\n    id,\r\n    title,\r\n    author,\r\n    op: \"update\"\r\n  };\r\n\r\n  return await sendRequest(params);\r\n};\r\n"]},"metadata":{},"sourceType":"module"}